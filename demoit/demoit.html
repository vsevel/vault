
<h1>Deploy Hashicorp Vault with Consul on Kubernetes</h1>

<div class="logos">
        <img src="/images/k8s_vault_consul.png" />
</div>

---

<h1>Goals</h1>

<h2>A (near) enterprise ready secret management solution</h2>
<h2>Educational: How easy is it to integrate solutions into Kubernetes</h2>

---

<h1>About myself</h1>

<h2>...</h2>

---

<h1>Why Vault, why Consul?</h1>

<h2>Vault: De facto standard for secret management</h2>
<h2>Consul: Works well with Vault as Storage backend</h2>
<h2>Complete solution brings interesting integration challenges</h2>

---

<h1>My first Vault</h1>

<div class="split">
    <web-term path="1-vault"></web-term>
    <source-code folder="1-vault"
        files="vault-deployment.yaml vault-pvc.yaml vault-config.json vault-service.yaml cheat-sheet"
        start-lines="0"
        end-lines="0">
    </source-code>
</div>

---

<h1>My first Vault</h1>

<img src="/images/diag1.png" />

---

<h1>My first Vault: Recap</h1>

<h2>NodePort Service</h2>
<h2>Deployment</h2>
<h2>StorageClass</h2>
<h2>PV & PVC</h2>

---

<h1>My first Vault: Can we do better?</h1>

<h2>HA Consul Storage</h2>
<h2>Ingress vs NodePort</h2>
<h2>TLS</h2>
<h2>Liveness vs Readyness</h2>
<h2>Kubernetes Authentication Delegation</h2>

---

<h1>HA Consul Storage</h1>

<div class="split">
    <web-term path="2-vault"></web-term>
    <source-code folder="2-vault"
        files="cheat-sheet vault-deployment.yaml"
        start-lines="0;30"
        end-lines="0;61">
    </source-code>
</div>

---

<h1>HA Consul Storage</h1>

<img src="/images/diag2.png" />

---

<h1>HA Consul Storage: Recap</h1>

<h2>StatefulSet</h2>
<h2>DaemonSet</h2>
<h2>API Server</h2>

---

<h1>Ingress</h1>

<div class="split">
    <web-term path="3-vault"></web-term>
    <source-code folder="3-vault"
        files="cheat-sheet vault-ingress.yaml vault-service.yaml"
        start-lines="0;0;0"
        end-lines="0;0;0">
    </source-code>
</div>

---

<h1>Ingress</h1>

<img src="/images/diag3.png" />

---

<h1>Ingress: Recap</h1>

<h2>Ingress Controller: nginx</h2>
<h2>Ingress</h2>

---

<h1>TLS</h1>

<div class="split">
    <web-term path="4-vault"></web-term>
    <source-code folder="4-vault"
        files="cheat-sheet create-cert.sh vault-csr.json vault-deployment.yaml vault-ingress.yaml nginx-ingress-controller.yaml"
        start-lines="0;0;0;58,64,70,75,77;7,17;222"
        end-lines="0;0;0;59,65,70,75,79;7,18;223">
    </source-code>
</div>

---

<h1>TLS</h1>

<img src="/images/diag4.png" />

---

<h1>Readiness & Liveness</h1>

<div class="split">
    <web-term path="5-vault"></web-term>
    <source-code folder="5-vault"
        files="cheat-sheet vault-deployment.yaml"
        start-lines="0;73"
        end-lines="0;73">
    </source-code>
</div>

---

<h1>Business Application</h1>

<div class="split">
    <web-term path="6-vault"></web-term>
    <source-code folder="6-vault"
        files="cheat-sheet cluster-role-auth-delegator.yaml mypolicy.hcl myapp.yaml"
        start-lines="0;0;0;0"
        end-lines="0;0;0;0">
    </source-code>
</div>

---

<h1>Vault Admin</h1>

<div class="split">
    <web-term path="7-vault"></web-term>
    <source-code folder="7-vault"
        files="cheat-sheet role-pod-reader.yaml"
        start-lines="0;0"
        end-lines="0;0">
    </source-code>
</div>

---

<h1>Hello, World!</h1>

<h2>This is a simple slide</h2>
<h2>With just <em>text</em></h2>

---

<h1>Logos</h1>

<div class="logos">
    <img src="/images/kubernetes.png" />
    <img src="/images/kubernetes.png" />
</div>

---

<h1>Snapshot</h1>

<img src="/images/bazel.png" />

---

<h1>Terminal</h1>

<div class="split">
    <web-term path="folder"></web-term>
</div>

---

<h1>Split view - Shell/Browser</h1>

<p>Type `python -m SimpleHTTPServer` in the shell window</p>

<div class="split">
    <web-term path="folder"></web-term>
    <web-browser src="http://localhost:8000/"></web-browser>
</div>

<style>
    p {
        font-style: italic;
        font-size: .5em;
    }

    .split {
        height: calc(100% - 9em);
    }
</style>

---

<h1>Code samples</h1>

<div class="split">
    <source-code folder="sources"
        files="main.go pod.yaml"
        start-lines="10;4,7"
        end-lines="11;4,8">
    </source-code>
</div>

---

<h1>Draw on slides</h1>

<p>On the left border of the page there's a pen that can be used to draw on the slides. Type <em>&lt;ESC&gt;</em> to exit draw mode.</p>

<img src="/images/bazel.png" />
<script src="/js/draw.js"></script>